# Call Graph Analyzer - å®Œæ•´ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£æä¾› Call Graph Analyzer çš„è¯¦ç»†ä½¿ç”¨è¯´æ˜ã€æœ€ä½³å®è·µå’Œå®é™…æ¡ˆä¾‹ã€‚

## ç›®å½•

1. [å®‰è£…é…ç½®](#å®‰è£…é…ç½®)
2. [åŸºç¡€ç”¨æ³•](#åŸºç¡€ç”¨æ³•)
3. [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
4. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
5. [å®é™…æ¡ˆä¾‹](#å®é™…æ¡ˆä¾‹)
6. [Python API](#python-api)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å®‰è£…é…ç½®

### ç³»ç»Ÿè¦æ±‚

- Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ“ä½œç³»ç»Ÿï¼šLinux, macOS, Windows
- æ¨èï¼š4 æ ¸æˆ–ä»¥ä¸Š CPUï¼Œ4GB ä»¥ä¸Šå†…å­˜

### å®‰è£…æ­¥éª¤

#### æ–¹æ³• 1: ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd /path/to/call_graph

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Linux/macOS:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# 4. å®‰è£…ä¾èµ–
pip install -e .
```

#### æ–¹æ³• 2: å…¨å±€å®‰è£…

```bash
cd /path/to/call_graph
pip install -e .
```

### éªŒè¯å®‰è£…

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
python call-graph.py --help

# æˆ–ä½¿ç”¨æ¨¡å—æ–¹å¼
python -m call_graph --help
```

---

## åŸºç¡€ç”¨æ³•

### 1. åˆ†æé¡¹ç›®

#### æœ€ç®€å•çš„ç”¨æ³•

```bash
# åˆ†æé¡¹ç›®åˆ°é»˜è®¤æ•°æ®åº“ call_graph.db
python call-graph.py analyze /path/to/your/project
```

#### æŒ‡å®šæ•°æ®åº“

```bash
# ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®åº“
python call-graph.py --database myproject.db analyze /path/to/your/project
```

#### æ¸…ç©ºæ—§æ•°æ®

```bash
# æ¸…ç©ºæ•°æ®åº“åé‡æ–°åˆ†æ
python call-graph.py --database myproject.db analyze /path/to/your/project --clear
```

#### æ’é™¤ç‰¹å®šç›®å½•

```bash
# æ’é™¤ä¸éœ€è¦åˆ†æçš„ç›®å½•
python call-graph.py --database myproject.db analyze /path/to/your/project \
  --exclude "node_modules,venv,build,dist,target,test,tests"
```

### 2. æŸ¥è¯¢è°ƒç”¨å…³ç³»

#### æŸ¥è¯¢è°è°ƒç”¨äº†æŸä¸ªå‡½æ•°

```bash
python call-graph.py --database myproject.db query calculate_total --callers
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
æŸ¥è¯¢è°ƒç”¨ 'calculate_total' çš„æ‰€æœ‰å‡½æ•°:

1. process_order(/path/to/order.py:45)
2. update_invoice(/path/to/invoice.py:78)
3. generate_report(/path/to/report.py:123)
```

æ˜¾ç¤ºè°ƒç”¨ç‚¹ä¿¡æ¯ï¼ˆverbose æ¨¡å¼ï¼‰ï¼š

```bash
python call-graph.py --database myproject.db query calculate_total --callers --verbose
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
æŸ¥è¯¢è°ƒç”¨ 'calculate_total' çš„æ‰€æœ‰å‡½æ•°:

1. process_order(/path/to/order.py:45)
   è°ƒç”¨ä½ç½®: /path/to/order.py:67
2. update_invoice(/path/to/invoice.py:78)
   è°ƒç”¨ä½ç½®: /path/to/invoice.py:92
```

**è¯´æ˜**ï¼š

- è‡ªåŠ¨å»é‡ï¼šç›¸åŒå‡½æ•°åªæ˜¾ç¤ºä¸€æ¬¡
- å¤šæ¬¡è°ƒç”¨æ ‡æ³¨ï¼šæ˜¾ç¤º `(å…± N å¤„è°ƒç”¨)`
- é»˜è®¤æ˜¾ç¤ºå‡½æ•°å®šä¹‰ä½ç½®ï¼š`å‡½æ•°å(æ–‡ä»¶:è¡Œå·)`
- verbose æ¨¡å¼æ˜¾ç¤ºæ‰€æœ‰è°ƒç”¨ç‚¹çš„è¯¦ç»†ä½ç½®

#### æŸ¥è¯¢æŸä¸ªå‡½æ•°è°ƒç”¨äº†å“ªäº›å‡½æ•°

```bash
python call-graph.py --database myproject.db query main --callees
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
'main' è°ƒç”¨çš„æ‰€æœ‰å‡½æ•°:

1. initialize(/path/to/app.py:10)
2. process_data(/path/to/data.py:34)
3. save_results(/path/to/storage.py:56)
4. print(external)
```

**è¯´æ˜**ï¼š

- è‡ªåŠ¨å»é‡ï¼šç›¸åŒå‡½æ•°åªæ˜¾ç¤ºä¸€æ¬¡
- å¤šæ¬¡è°ƒç”¨æ ‡æ³¨ï¼šæ˜¾ç¤º `(å…± N å¤„è°ƒç”¨)`
- æ˜¾ç¤ºè¢«è°ƒç”¨å‡½æ•°çš„å®šä¹‰ä½ç½®ï¼š`å‡½æ•°å(æ–‡ä»¶:è¡Œå·)`
- å¤–éƒ¨å‡½æ•°ï¼ˆå¦‚æ ‡å‡†åº“å‡½æ•°ï¼‰æ ‡è®°ä¸º `(external)`

#### æŸ¥è¯¢è°ƒç”¨é“¾

```bash
# æŸ¥è¯¢ä» main å‡½æ•°å¼€å§‹çš„è°ƒç”¨é“¾ï¼Œæ·±åº¦ä¸º 5
python call-graph.py --database myproject.db query main --chain --depth 5
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
'main' çš„è°ƒç”¨é“¾ (æ·±åº¦=5):

1. main(/path/to/main.py:10) -> initialize(/path/to/app.py:5) -> load_config(/path/to/config.py:12) -> read_file(/path/to/io.py:23)
2. main(/path/to/main.py:10) -> process_data(/path/to/data.py:34) -> validate_input(/path/to/validator.py:15) -> check_format(/path/to/validator.py:25)
3. main(/path/to/main.py:10) -> process_data(/path/to/data.py:34) -> transform_data(/path/to/transform.py:45) -> apply_rules(/path/to/rules.py:12)
4. main(/path/to/main.py:10) -> save_results(/path/to/storage.py:56) -> write_file(/path/to/io.py:45)
```

**è¯´æ˜**ï¼š

- è‡ªåŠ¨å»é‡ï¼šç›¸åŒè°ƒç”¨é“¾åªæ˜¾ç¤ºä¸€æ¬¡
- æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼š`æ‰¾åˆ° N æ¡å”¯ä¸€è°ƒç”¨é“¾ (å·²å»é™¤ M æ¡é‡å¤)`
- æ¯ä¸ªå‡½æ•°éƒ½æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼š`å‡½æ•°å(æ–‡ä»¶:è¡Œå·)`
- å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æ•´ä¸ªè°ƒç”¨é“¾çš„ä»£ç ä½ç½®

#### æŸ¥è¯¢å®Œæ•´è°ƒç”¨è·¯å¾„

æŸ¥è¯¢åŒ…å«ç›®æ ‡å‡½æ•°çš„å®Œæ•´è°ƒç”¨è·¯å¾„ï¼ˆä»å…¥å£åˆ°å¶å­ï¼‰ï¼š

```bash
python call-graph.py --database myproject.db query process_data --fullpath
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
ç›®æ ‡å‡½æ•°: process_data
æ‰¾åˆ° 8 æ¡å®Œæ•´è°ƒç”¨è·¯å¾„

============================================================
å®Œæ•´è°ƒç”¨è·¯å¾„ï¼ˆå…¥å£ -> ç›®æ ‡ -> å¶å­ï¼‰:
============================================================
1. main(/path/to/main.py:10) -> [process_data(/path/to/data.py:34)] -> validate_input(/path/to/validator.py:15) -> check_format(/path/to/validator.py:25)
2. main(/path/to/main.py:10) -> [process_data(/path/to/data.py:34)] -> transform_data(/path/to/transform.py:45) -> apply_rules(/path/to/rules.py:12)
3. batch_process(/path/to/batch.py:56) -> [process_data(/path/to/data.py:34)] -> validate_input(/path/to/validator.py:15)
```

**è¯´æ˜**ï¼š

- ç›®æ ‡å‡½æ•°ç”¨ `[]` æ ‡è®°
- æ ¼å¼ï¼š`å‡½æ•°å(æ–‡ä»¶:è¡Œå·)`
- æ˜¾ç¤ºä»å…¥å£å‡½æ•°åˆ°å¶å­å‡½æ•°çš„å®Œæ•´è·¯å¾„

#### æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯

```bash
python call-graph.py --database myproject.db query process_data --fullpath --verbose
```

### 3. æœç´¢å‡½æ•°

#### åŸºæœ¬æœç´¢

```bash
# æœç´¢åŒ…å« "process" çš„å‡½æ•°
python call-graph.py --database myproject.db search "process"
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
æœç´¢ç¬¦å· 'process':

1. process_data (function) - /path/to/data.py:34
2. process_order (function) - /path/to/order.py:45
3. process_payment (function) - /path/to/payment.py:67
```

#### æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

```bash
python call-graph.py --database myproject.db search "process" --verbose
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
æœç´¢ç¬¦å· 'process':

1. process_data (function) - /path/to/data.py:34
   ç­¾å: def process_data(input_data: Dict[str, Any]) -> Dict[str, Any]

2. process_order (function) - /path/to/order.py:45
   ç­¾å: def process_order(order_id: int) -> bool

3. process_payment (function) - /path/to/payment.py:67
   ç­¾å: def process_payment(amount: float, method: str) -> str
```

### 4. æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```bash
python call-graph.py --database myproject.db stats
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
==================================================
æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
==================================================

æ€»ç¬¦å·æ•°: 1234
æ€»è°ƒç”¨å…³ç³»: 5678

æŒ‰è¯­è¨€ç»Ÿè®¡:
  python         :    567 ä¸ªç¬¦å·
  javascript     :    345 ä¸ªç¬¦å·
  typescript     :    234 ä¸ªç¬¦å·
  java           :     88 ä¸ªç¬¦å·

æŒ‰ç±»å‹ç»Ÿè®¡:
  function       :   1234 ä¸ª
```

### 5. å¯¼å‡ºè°ƒç”¨å›¾

#### å¯¼å‡ºä¸º DOT æ ¼å¼

```bash
# å¯¼å‡ºåˆ°æ–‡ä»¶
python call-graph.py --database myproject.db export --output graph.dot

# è¾“å‡ºï¼š
# å¯¼å‡ºæˆåŠŸ: 15 ä¸ªèŠ‚ç‚¹, 23 æ¡è¾¹
```

**è¯´æ˜**ï¼š

- åªå¯¼å‡ºé¡¹ç›®å†…éƒ¨å‡½æ•°ï¼ˆè‡ªåŠ¨è¿‡æ»¤å¤–éƒ¨å‡½æ•°å¦‚ `print`, `len` ç­‰ï¼‰
- åªå¯¼å‡ºæœ‰æ•ˆçš„å‡½æ•°è°ƒç”¨å…³ç³»ï¼ˆè¿‡æ»¤æ— æ•ˆèŠ‚ç‚¹å’Œè¾¹ï¼‰
- èŠ‚ç‚¹æ ‡ç­¾åŒ…å«ï¼šå‡½æ•°åã€æ–‡ä»¶è·¯å¾„ã€è¡Œå·
- è¾“å‡ºç»Ÿè®¡ä¿¡æ¯ï¼šèŠ‚ç‚¹æ•°å’Œè¾¹æ•°

#### ç”Ÿæˆå›¾ç‰‡

```bash
# éœ€è¦å…ˆå®‰è£… graphviz
# Ubuntu/Debian: sudo apt install graphviz
# macOS: brew install graphviz
# Windows: ä¸‹è½½å®‰è£… https://graphviz.org/download/

# ç”Ÿæˆ PNG å›¾ç‰‡
dot -Tpng graph.dot -o graph.png

# ç”Ÿæˆ SVG å›¾ç‰‡ï¼ˆæ¨èï¼Œå¯ç¼©æ”¾ï¼‰
dot -Tsvg graph.dot -o graph.svg

# ç”Ÿæˆ PDF
dot -Tpdf graph.dot -o graph.pdf

# å¤§å‹é¡¹ç›®ä½¿ç”¨å…¶ä»–å¸ƒå±€ç®—æ³•
dot -Tpng -Kfdp graph.dot -o graph.png # fdp å¸ƒå±€
dot -Tpng -Ksfdp graph.dot -o graph.png # sfdp å¸ƒå±€ï¼ˆé€‚åˆè¶…å¤§å›¾ï¼‰
```

---

## é«˜çº§åŠŸèƒ½

### 1. å¢é‡åˆ†æ

```bash
# ç¬¬ä¸€æ¬¡åˆ†æ
python call-graph.py --database myproject.db analyze /path/to/project --clear

# åç»­å¯ä»¥ä¸ä½¿ç”¨ --clearï¼Œæ·»åŠ æ–°çš„æ–‡ä»¶
python call-graph.py --database myproject.db analyze /path/to/new_module
```

**æ³¨æ„**ï¼šå¢é‡åˆ†æå¯èƒ½äº§ç”Ÿé‡å¤æ•°æ®ï¼Œå»ºè®®å®šæœŸä½¿ç”¨ `--clear` é‡æ–°åˆ†æã€‚

### 2. å¤šæ•°æ®åº“ç®¡ç†

ä¸ºä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ï¼š

```bash
# é¡¹ç›® A
python call-graph.py --database project_a.db analyze /path/to/project_a --clear

# é¡¹ç›® B
python call-graph.py --database project_b.db analyze /path/to/project_b --clear

# æŸ¥è¯¢é¡¹ç›® A
python call-graph.py --database project_a.db query main --callers

# æŸ¥è¯¢é¡¹ç›® B
python call-graph.py --database project_b.db query main --callers
```

### 3. å¤æ‚æŸ¥è¯¢ç»„åˆ

```bash
# 1. æœç´¢å‡½æ•°
python call-graph.py --database myproject.db search "auth"

# 2. æŸ¥è¯¢æ‰¾åˆ°çš„å‡½æ•°çš„è°ƒç”¨å…³ç³»
python call-graph.py --database myproject.db query authenticate --callers
python call-graph.py --database myproject.db query authenticate --callees

# 3. æŸ¥çœ‹å®Œæ•´è°ƒç”¨è·¯å¾„
python call-graph.py --database myproject.db query authenticate --fullpath
```

---

## æ€§èƒ½ä¼˜åŒ–

### æ ‡å‡†æ¨¡å¼ vs ä¼˜åŒ–æ¨¡å¼

#### æ ‡å‡†æ¨¡å¼

é€‚åˆå°å‹é¡¹ç›®ï¼ˆ< 500 æ–‡ä»¶ï¼‰ï¼š

```bash
python call-graph.py --database myproject.db analyze /path/to/project --clear
```

#### æ€§èƒ½ä¼˜åŒ–æ¨¡å¼

é€‚åˆå¤§å‹é¡¹ç›®ï¼ˆ> 500 æ–‡ä»¶ï¼‰ï¼Œä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†ï¼š

```bash
# åŸºæœ¬ç”¨æ³•
python call-graph.py --database myproject.db analyze /path/to/project --clear --fast
```

### è‡ªå®šä¹‰æ€§èƒ½å‚æ•°

#### å·¥ä½œè¿›ç¨‹æ•°

```bash
# ä½¿ç”¨ 8 ä¸ªå·¥ä½œè¿›ç¨‹
python call-graph.py --database myproject.db analyze /path/to/project \
  --clear --fast --workers 8
```

**å»ºè®®**ï¼š

- 4 æ ¸ CPU â†’ `--workers 3`
- 8 æ ¸ CPU â†’ `--workers 6-7`
- 16 æ ¸ CPU â†’ `--workers 12-14`

#### æ‰¹æ¬¡å¤§å°

```bash
# æ‰¹é‡æ’å…¥ 200 æ¡è®°å½•
python call-graph.py --database myproject.db analyze /path/to/project \
  --clear --fast --batch-size 200
```

**å»ºè®®**ï¼š

- < 500 æ–‡ä»¶ â†’ `--batch-size 50`
- 500-2000 æ–‡ä»¶ â†’ `--batch-size 100`
- 2000-5000 æ–‡ä»¶ â†’ `--batch-size 150-200`
- > 5000 æ–‡ä»¶ â†’ `--batch-size 200-300`

#### å®Œæ•´ä¼˜åŒ–ç¤ºä¾‹

```bash
# é’ˆå¯¹å¤§å‹é¡¹ç›®çš„å®Œæ•´ä¼˜åŒ–å‘½ä»¤
python call-graph.py --database bigproject.db analyze /path/to/big/project \
  --clear \
  --fast \
  --workers 8 \
  --batch-size 200 \
  --exclude "node_modules,venv,build,dist,target,test,tests,doc,docs"
```

### æ€§èƒ½å¯¹æ¯”æ•°æ®

| é¡¹ç›®è§„æ¨¡ | æ–‡ä»¶æ•° | å‡½æ•°æ•° | æ ‡å‡†æ¨¡å¼ | ä¼˜åŒ–æ¨¡å¼ | æå‡ |
| -------- | ------ | ------ | -------- | -------- | ---- |
| å°å‹     | 100    | 500    | 15 ç§’    | 10 ç§’    | 1.5x |
| ä¸­å‹     | 500    | 2000   | 2 åˆ†é’Ÿ   | 30 ç§’    | 4x   |
| å¤§å‹     | 2000   | 12000  | 15 åˆ†é’Ÿ  | 3 åˆ†é’Ÿ   | 5x   |
| è¶…å¤§å‹   | 5000+  | 30000+ | 30+åˆ†é’Ÿ  | 6 åˆ†é’Ÿ   | 5-7x |

---

## å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: åˆ†æ Python Web é¡¹ç›®

```bash
# 1. åˆ†æ Django/Flask é¡¹ç›®
python call-graph.py --database webapp.db analyze /path/to/webapp \
  --clear --fast \
  --exclude "venv,migrations,static,media,tests"

# 2. æŸ¥æ‰¾æ‰€æœ‰è§†å›¾å‡½æ•°
python call-graph.py --database webapp.db search "view"

# 3. åˆ†æè¯·æ±‚å¤„ç†æµç¨‹
python call-graph.py --database webapp.db query index_view --fullpath

# 4. æŸ¥çœ‹ç»Ÿè®¡
python call-graph.py --database webapp.db stats
```

### æ¡ˆä¾‹ 2: åˆ†æ Node.js é¡¹ç›®

```bash
# 1. åˆ†æé¡¹ç›®ï¼ˆæ’é™¤ node_modulesï¼‰
python call-graph.py --database nodeapp.db analyze /path/to/nodeapp \
  --clear --fast \
  --exclude "node_modules,dist,coverage"

# 2. æŸ¥æ‰¾è·¯ç”±å¤„ç†å™¨
python call-graph.py --database nodeapp.db search "handler"

# 3. åˆ†æ API è°ƒç”¨é“¾
python call-graph.py --database nodeapp.db query apiHandler --chain --depth 5
```

### æ¡ˆä¾‹ 3: åˆ†æå¾®æœåŠ¡æ¶æ„

```bash
# ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºç‹¬ç«‹æ•°æ®åº“

# æœåŠ¡ A
python call-graph.py --database service_a.db analyze /path/to/service_a --clear --fast

# æœåŠ¡ B
python call-graph.py --database service_b.db analyze /path/to/service_b --clear --fast

# æœåŠ¡ C
python call-graph.py --database service_c.db analyze /path/to/service_c --clear --fast

# åˆ†ææ¯ä¸ªæœåŠ¡çš„è°ƒç”¨å…³ç³»
python call-graph.py --database service_a.db query process_request --fullpath
python call-graph.py --database service_b.db query handle_event --fullpath
```

### æ¡ˆä¾‹ 4: é‡æ„è¾…åŠ©

```bash
# 1. åˆ†æç°æœ‰ä»£ç 
python call-graph.py --database refactor.db analyze /path/to/project --clear --fast

# 2. æ‰¾åˆ°è¦é‡æ„çš„å‡½æ•°
python call-graph.py --database refactor.db search "old_function"

# 3. æŸ¥çœ‹å½±å“èŒƒå›´ï¼ˆæ‰€æœ‰è°ƒç”¨è€…ï¼‰
python call-graph.py --database refactor.db query old_function --callers

# 4. æŸ¥çœ‹ä¾èµ–ï¼ˆæ‰€æœ‰è¢«è°ƒç”¨è€…ï¼‰
python call-graph.py --database refactor.db query old_function --callees

# 5. æŸ¥çœ‹å®Œæ•´è°ƒç”¨è·¯å¾„
python call-graph.py --database refactor.db query old_function --fullpath --verbose
```

---

## Python API

### åŸºæœ¬ä½¿ç”¨

```python
from call_graph.analyzer import CallGraphAnalyzer

# åˆ›å»ºåˆ†æå™¨
analyzer = CallGraphAnalyzer("myproject.db")

# åˆ†æé¡¹ç›®
stats = analyzer.analyze_project("/path/to/project")
print(f"æ‰¾åˆ° {stats['total_symbols']} ä¸ªç¬¦å·")
print(f"æ‰¾åˆ° {stats['total_relations']} ä¸ªè°ƒç”¨å…³ç³»")

# æŸ¥è¯¢
callers = analyzer.query_callers("my_function")
for caller in callers:
    print(f"{caller['caller_name']} è°ƒç”¨äº† my_function")

# å…³é—­
analyzer.close()
```

### ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
from call_graph.analyzer import CallGraphAnalyzer

with CallGraphAnalyzer("myproject.db") as analyzer:
    # åˆ†æé¡¹ç›®
    analyzer.analyze_project("/path/to/project")

    # æŸ¥è¯¢
    results = analyzer.search_functions("process")
    for result in results:
        print(f"{result['name']} - {result['file']}:{result['start_line']}")
```

### æ€§èƒ½ä¼˜åŒ–æ¨¡å¼

```python
from call_graph.analyzer_optimized import CallGraphAnalyzerOptimized

# åˆ›å»ºä¼˜åŒ–åˆ†æå™¨ï¼ˆä½¿ç”¨ 8 ä¸ªå·¥ä½œè¿›ç¨‹ï¼‰
analyzer = CallGraphAnalyzerOptimized("bigproject.db", num_workers=8)

# åˆ†æé¡¹ç›®ï¼ˆæ‰¹é‡æ“ä½œï¼‰
stats = analyzer.analyze_project(
    "/path/to/big/project",
    exclude_dirs=["node_modules", "venv", "build"],
    batch_size=200,
    show_progress=True
)

print(f"è€—æ—¶: {stats['elapsed_time']:.2f} ç§’")
print(f"å¤„ç†é€Ÿåº¦: {stats['files_per_second']:.1f} æ–‡ä»¶/ç§’")

analyzer.close()
```

### å®Œæ•´è°ƒç”¨è·¯å¾„æŸ¥è¯¢

```python
from call_graph.analyzer import CallGraphAnalyzer

analyzer = CallGraphAnalyzer("myproject.db")

# æŸ¥è¯¢å®Œæ•´è°ƒç”¨è·¯å¾„
result = analyzer.query_full_call_paths("process_data", max_depth=10)

print(f"æ‰¾åˆ° {result['full_count']} æ¡å®Œæ•´è·¯å¾„")

# æ˜¾ç¤ºè·¯å¾„
for i, path_detail in enumerate(result['full_paths_detailed'], 1):
    path_str = " -> ".join([
        f"{func['name']}({func['file']}:{func['line']})"
        for func in path_detail
    ])
    print(f"{i}. {path_str}")

analyzer.close()
```

### å¯¼å‡ºè°ƒç”¨å›¾

```python
from call_graph.analyzer import CallGraphAnalyzer

analyzer = CallGraphAnalyzer("myproject.db")

# å¯¼å‡ºä¸º DOT æ ¼å¼
dot_content = analyzer.export_graph(output_format='dot')

# ä¿å­˜åˆ°æ–‡ä»¶
with open('graph.dot', 'w', encoding='utf-8') as f:
    f.write(dot_content)

analyzer.close()
```

---

## æœ€ä½³å®è·µ

### 1. é¡¹ç›®åˆ†æ

#### âœ… æ¨èåšæ³•

```bash
# 1. ä½¿ç”¨æ¸…æ™°çš„æ•°æ®åº“å‘½å
python call-graph.py --database <project_name>_<version>.db ...

# 2. é¦–æ¬¡åˆ†æä½¿ç”¨ --clear
python call-graph.py --database myproject.db analyze /path/to/project --clear

# 3. å¤§å‹é¡¹ç›®ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–æ¨¡å¼
python call-graph.py --database myproject.db analyze /path/to/project --clear --fast

# 4. æ’é™¤ä¸éœ€è¦çš„ç›®å½•
python call-graph.py --database myproject.db analyze /path/to/project \
  --exclude "node_modules,venv,build,dist,target,test,tests,doc"
```

#### âŒ é¿å…åšæ³•

```bash
# ä¸è¦å¿˜è®° --clearï¼ˆå¯èƒ½äº§ç”Ÿé‡å¤æ•°æ®ï¼‰
python call-graph.py --database myproject.db analyze /path/to/project

# ä¸è¦åˆ†æä¸å¿…è¦çš„ç›®å½•ï¼ˆæµªè´¹æ—¶é—´ï¼‰
python call-graph.py --database myproject.db analyze /path/to/project
# åº”è¯¥æ’é™¤ node_modules ç­‰

# å¤§å‹é¡¹ç›®ä¸è¦ä½¿ç”¨æ ‡å‡†æ¨¡å¼ï¼ˆå¤ªæ…¢ï¼‰
python call-graph.py --database bigproject.db analyze /huge/project
# åº”è¯¥ä½¿ç”¨ --fast
```

### 2. æ•°æ®åº“ç®¡ç†

```bash
# ä¸ºä¸åŒåˆ†æ”¯åˆ›å»ºä¸åŒæ•°æ®åº“
python call-graph.py --database myproject_main.db analyze /path/to/main_branch --clear
python call-graph.py --database myproject_feature.db analyze /path/to/feature_branch --clear

# å®šæœŸé‡æ–°åˆ†æï¼ˆæ¸…ç†æ—§æ•°æ®ï¼‰
python call-graph.py --database myproject.db analyze /path/to/project --clear

# å¤‡ä»½é‡è¦çš„åˆ†æç»“æœ
cp myproject.db myproject_backup_$(date +%Y%m%d).db
```

### 3. æŸ¥è¯¢ä¼˜åŒ–

```bash
# 1. å…ˆæœç´¢ç¡®å®šå‡½æ•°å
python call-graph.py --database myproject.db search "my_func"

# 2. å†è¿›è¡Œç²¾ç¡®æŸ¥è¯¢
python call-graph.py --database myproject.db query exact_function_name --fullpath

# 3. ä½¿ç”¨åˆé€‚çš„æ·±åº¦é™åˆ¶
python call-graph.py --database myproject.db query func --chain --depth 5
# ä¸è¦è®¾ç½®è¿‡å¤§çš„æ·±åº¦ï¼Œé¿å…ç»“æœè¿‡å¤š
```

### 4. å·¥ä½œæµå»ºè®®

```bash
# æ—¥å¸¸å¼€å‘å·¥ä½œæµ

# 1. æ—©ä¸Šç¬¬ä¸€ä»¶äº‹ï¼šåˆ†ææœ€æ–°ä»£ç 
python call-graph.py --database daily.db analyze /path/to/project --clear --fast

# 2. å¼€å‘ä¸­ï¼šæŸ¥è¯¢å‡½æ•°å…³ç³»
python call-graph.py --database daily.db query new_function --callers
python call-graph.py --database daily.db query new_function --callees

# 3. é‡æ„å‰ï¼šåˆ†æå½±å“èŒƒå›´
python call-graph.py --database daily.db query old_function --fullpath --verbose

# 4. ä»£ç å®¡æŸ¥ï¼šæ£€æŸ¥è°ƒç”¨å…³ç³»
python call-graph.py --database daily.db query reviewed_function --chain --depth 3

# 5. ç”Ÿæˆæ–‡æ¡£ï¼šå¯¼å‡ºè°ƒç”¨å›¾
python call-graph.py --database daily.db export --output daily_graph.dot
dot -Tpng daily_graph.dot -o daily_graph.png
```

---

## å¸¸è§é—®é¢˜

### Q1: åˆ†æé€Ÿåº¦å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**: ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–æ¨¡å¼ï¼š

```bash
python call-graph.py --database myproject.db analyze /path/to/project \
  --clear --fast --workers 8 --batch-size 200
```

### Q2: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

**A**: å‡å°‘å·¥ä½œè¿›ç¨‹æ•°å’Œæ‰¹æ¬¡å¤§å°ï¼š

```bash
python call-graph.py --database myproject.db analyze /path/to/project \
  --clear --fast --workers 4 --batch-size 50
```

### Q3: å¦‚ä½•åªåˆ†æç‰¹å®šè¯­è¨€çš„æ–‡ä»¶ï¼Ÿ

**A**: ç›®å‰ä¸æ”¯æŒè¯­è¨€è¿‡æ»¤ï¼Œä½†å¯ä»¥é€šè¿‡æ’é™¤å…¶ä»–è¯­è¨€çš„ç›®å½•å®ç°ï¼š

```bash
# åªåˆ†æ Python ä»£ç ï¼ˆæ’é™¤å…¶ä»–è¯­è¨€çš„ç›®å½•ï¼‰
python call-graph.py --database python_only.db analyze /path/to/project \
  --exclude "node_modules,src/main/java,src/cpp"
```

### Q4: æŸ¥è¯¢ç»“æœä¸ºç©ºæ€ä¹ˆåŠï¼Ÿ

**A**:

1. ç¡®è®¤å‡½æ•°åæ‹¼å†™æ­£ç¡®
2. å…ˆç”¨ search å‘½ä»¤æœç´¢å‡½æ•°
3. æ£€æŸ¥æ˜¯å¦æˆåŠŸåˆ†æäº†é¡¹ç›®

```bash
# 1. æœç´¢å‡½æ•°
python call-graph.py --database myproject.db search "my_func"

# 2. æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
python call-graph.py --database myproject.db stats

# 3. å¦‚æœç»Ÿè®¡ä¸ºç©ºï¼Œé‡æ–°åˆ†æ
python call-graph.py --database myproject.db analyze /path/to/project --clear
```

### Q5: æ•°æ®åº“æ–‡ä»¶å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ

**A**:

1. ä½¿ç”¨ `--clear` é‡æ–°åˆ†æï¼ˆåˆ é™¤æ—§æ•°æ®ï¼‰
2. ä½¿ç”¨æ›´å…·ä½“çš„ `--exclude` æ’é™¤ä¸å¿…è¦çš„ç›®å½•
3. ä¸ºä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒæ•°æ®åº“

### Q6: å¦‚ä½•åœ¨ CI/CD ä¸­ä½¿ç”¨ï¼Ÿ

**A**:

```bash
# .gitlab-ci.yml æˆ– .github/workflows/analyze.yml

analyze-code:
  script:
    - pip install -e .
    - python call-graph.py --database ci.db analyze . --clear --fast
    - python call-graph.py --database ci.db stats
    - python call-graph.py --database ci.db export --output graph.dot
  artifacts:
    paths:
      - ci.db
      - graph.dot
```

### Q7: æ”¯æŒè·¨æ–‡ä»¶çš„å‡½æ•°è°ƒç”¨å—ï¼Ÿ

**A**: æ˜¯çš„ï¼Œå®Œå…¨æ”¯æŒã€‚åˆ†æå™¨ä¼šæå–æ‰€æœ‰æ–‡ä»¶ä¸­çš„å‡½æ•°å®šä¹‰å’Œè°ƒç”¨ï¼Œå¹¶å»ºç«‹è·¨æ–‡ä»¶çš„è°ƒç”¨å…³ç³»ã€‚

### Q8: å¦‚ä½•å¤„ç†åŒåå‡½æ•°ï¼Ÿ

**A**: æ•°æ®åº“ä¸­å­˜å‚¨äº†å®Œæ•´çš„æ–‡ä»¶è·¯å¾„å’Œè¡Œå·ï¼Œå¯ä»¥åŒºåˆ†ä¸åŒæ–‡ä»¶ä¸­çš„åŒåå‡½æ•°ã€‚

```bash
# æŸ¥è¯¢ä¼šæ˜¾ç¤ºæ‰€æœ‰åŒåå‡½æ•°
python call-graph.py --database myproject.db search "init"
```

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
